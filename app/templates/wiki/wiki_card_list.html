{% extends 'wiki/wiki_list_base.html' %}
{% block wiki_list %}
<div class="card box-shadow">
    <!-- 검색창 -->
    <div class="d-flex border-bottom gap-2 px-2 py-3 mx-2 mb-3">
        <input class="form-control align-self-center"
               type="text"
               id="search_kw"
               placeholder="Search..."
               oninput="updateCardList()">
    </div>

    <!-- 카드 목록 -->
    <div class="wiki-list-container d-flex justify-content-center pt-3" style="overflow: auto; height: 600px;">
        <h4 id="no_result" style="display: none;">해당하는 카드가 없습니다.</h4>
        <ul class="text-center w-100 px-2">
            {% for i in range(card_list|length) %}
            <li class="wiki-list-item box-shadow mx-1 mx-md-2 mb-2 mb-md-3" style="display: inline-block;">
                <a href="{{ url_for('wiki.card_detail', card_id=card_list[i].id) }}">
                    <img src="{{ url_for('static', filename=card_list[i].image) }}" alt="/static/images/defaults/card.png" class="rounded img-thumbnail" width="150">
                </a>
                <div name="card-info">
                    <input type="hidden" value="{{ card_list[i].name }}">
                    <input type="hidden" value="{{ card_en_list[i].name }}">
                    <input type="hidden" value="{{ card_list[i].cost }}">
                    <input type="hidden" value="{{ card_list[i].type }}">
                    <input type="hidden" value="{{ card_en_list[i].type }}">
                    <input type="hidden" value="{{ card_list[i].effect }}">
                    <input type="hidden" value="{{ card_en_list[i].effect }}">
                </div>
            </li>
            {% endfor %}

            <!-- Append Button -->
            <li class="wiki-list-item box-shadow d-inline-block mx-1 mx-md-2 mb-2 mb-md-3">
                <a class="d-block" href="{{ url_for('wiki.append_card') }}"><img src="/static/images/defaults/wiki_append.png" class="rounded img-thumbnail" width="150"></a>
            </li>

            <!-- Placeholders -->
            <li class="wiki-list-placeholder mx-1 mx-md-2 mb-2 mb-md-3" style="display: none;"></li>
            <li class="wiki-list-placeholder mx-1 mx-md-2 mb-2 mb-md-3" style="display: none;"></li>
            <li class="wiki-list-placeholder mx-1 mx-md-2 mb-2 mb-md-3" style="display: none;"></li>
            <li class="wiki-list-placeholder mx-1 mx-md-2 mb-2 mb-md-3" style="display: none;"></li>
            <li class="wiki-list-placeholder mx-1 mx-md-2 mb-2 mb-md-3" style="display: none;"></li>
        </ul>
    </div>
</div>
{% endblock %}

{% block script %}
<script>
const searchBar = document.getElementById('search_kw');
const placeholderList = [...document.getElementsByClassName('wiki-list-placeholder')];
var cardInfoList = [...document.getElementsByName('card-info')];

updateCardList();

function updateCardList() {
    let cardCount = 0;
    for (let cardInfo of cardInfoList) {
        let hasKeyword = false;
        for (let info of cardInfo.children) {
            hasKeyword = hasKeyword || (info.value.includes(searchBar.value) || info.value.toLowerCase().includes(searchBar.value));
        }

        cardInfo.parentElement.style.display = hasKeyword ? 'inline-block' : 'none';
        cardCount += hasKeyword ? 1 : 0;
    }

    updatePlaceHolders(6 - (cardCount + 1) % 6);
}

function updatePlaceHolders(count) {
    for (let i = 0; i < count; i++) {
        placeholderList[i].style.display = 'inline-block'
    }
    for (let i = count; i < placeholderList.length; i++) {
        placeholderList[i].style.display = 'none';
    }
}
</script>
{% endblock %}
